<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title> M3U8 Detector Bookmarklet </title>
</head>

<body>

<p>Drag the link below to your bookmarks bar to add the <strong>M3U8 Detector</strong> bookmarklet.</p>

<p><a href="javascript:(function init(){if(window.__setM3U8URL__)return;var debugMode=true;var log=console.log;function debug(msg){if(debugMode){log('[M3U8 Detector] ['+location.href+'] '+msg)}}var m3u8URL='';var copyButton;window.__setM3U8URL__=function(url){if(window.parent===window.self){url=url.split('#')[0];if(m3u8URL===url)return;debug('Set URL: '+url);m3u8URL=url;if(copyButton){copyButton.className='animation';copyButton.disabled=false}}else{window.parent.__setM3U8URL__(url)}};function injectScript(iframe){var win=iframe.contentWindow;try{win.eval}catch(e){return}debug('Inject script to iframe\'s window');win.eval('('+init.toString()+')();')}function checkVideo(video){if(!video)return;if(video.src&&/\.m3u8/i.test(video.src)){debug('video.src: '+video.src);__setM3U8URL__(video.src)}var sources=video.querySelectorAll('source');for(var i=0;i<sources.length;i++){if(sources[i].src&&/\.m3u8/i.test(sources[i].src)){debug('video>source['+i+'].src: '+sources[i].src);__setM3U8URL__(sources[i].src)}}for(var attr in video.dataset){if(typeof video.dataset[attr]==='string'&&/\.m3u8/i.test(video.dataset[attr])){debug('video.dataset['+attr+']: '+video.dataset[attr]);__setM3U8URL__(video.dataset[attr])}}}var originalOpen=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(method,url){if(url&&typeof url==='string'&&/\.m3u8$|\.m3u8\?/i.test(url)){debug('xhr.open: '+url);__setM3U8URL__(url)}return originalOpen.apply(this,arguments)};debug('xhr.open() has been overridden');var originalFetch=window.fetch;window.fetch=function(input){try{var url='';if(typeof input==='string'){url=input}else if(input instanceof Request){url=input.url}if(url&&/\.m3u8$|\.m3u8\?/i.test(url)){debug('fetch: '+url);__setM3U8URL__(url)}}catch(e){debug('Error in fetch override: '+e.message)}return originalFetch.apply(this,arguments)};debug('fetch() has been overridden');function createUI(){var style=document.createElement('style');style.textContent=`#m3u8-detector-panel{position:fixed;z-index:2147483647;box-sizing:content-box;top:10px;right:10px;margin:0;padding:5px;width:auto;height:auto;border:none;border-radius:5px;background:rgba(0,123,255,0.7)}#m3u8-detector-panel button{display:flex;justify-content:center;align-items:center;box-sizing:content-box;margin:0;padding:5px;width:auto;height:14px;font-size:14px;border:none;border-radius:3px;user-select:none;color:#007bff;background:#fff;cursor:pointer}#m3u8-detector-panel button:disabled{color:#777;background:#b0b0b0;cursor:not-allowed}#m3u8-detector-panel button:enabled:active{color:#f00}@keyframes in-out{0%,100%{color:#7bbbff;background:#fff}50%{color:#fff;background:#7bbbff}}#m3u8-detector-panel button.animation{animation:in-out 1s ease-in-out 1}`;document.head.appendChild(style);var panel=document.createElement('div');panel.id='m3u8-detector-panel';document.body.appendChild(panel);copyButton=document.createElement('button');copyButton.disabled=true;copyButton.textContent='Copy';copyButton.onanimationend=function(){this.className=''};copyButton.onclick=function(){if(navigator.clipboard&&navigator.clipboard.writeText){navigator.clipboard.writeText(m3u8URL)}};panel.appendChild(copyButton);debug('Detector UI has created')}var isReady=false;function domReady(){if(isReady)return;isReady=true;if(window.parent===window.self){createUI()}var observer=new MutationObserver(function(mutations){mutations.forEach(function(mutation){if(mutation.type==='childList'){mutation.addedNodes.forEach(function(node){if(node.nodeName==='IFRAME'){debug('Observed an iframe element added');injectScript(node)}else if(node.nodeName==='VIDEO'){checkVideo(node)}else if(node.querySelectorAll){node.querySelectorAll('video').forEach(checkVideo);var iframes=node.querySelectorAll('iframe');if(iframes.length){debug('Observed iframe elements added: '+iframes.length);iframes.forEach(injectScript)}}})}else if(mutation.type==='attributes'){if(mutation.target.nodeName==='IFRAME'&&mutation.attributeName==='src'){debug('iframe\'s src has changed');mutation.target.contentWindow.addEventListener('unload',function(){setTimeout(function(){injectScript(mutation.target)},0)})}else if(mutation.target.nodeName==='VIDEO'){checkVideo(mutation.target)}}})});observer.observe(document.body,{childList:true,subtree:true,attributes:true,attributeFilter:['src','data-src']});debug('DOM observer started');var videos=document.querySelectorAll('video');debug('Found video elements: '+videos.length);videos.forEach(checkVideo);var iframes=document.querySelectorAll('iframe');debug('Found iframe elements: '+iframes.length);iframes.forEach(injectScript)}if(document.readyState==='loading'){document.addEventListener('readystatechange',domReady)}else{domReady()}})();">M3U8 Detector</a></p>

</body>
</html>
